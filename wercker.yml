box: debian
build:
    steps:
        - arjen/hugo-build
deploy:
    steps:
        - install-packages:
            packages: git ssh-client
        - lukevivier/gh-pages:
            token: $GITHUB_TOKEN
            domain: visnz.guediao.top
            basedir: public
            repo: visnz/visnz.github.io
deploy-gitea:
    steps:
        - install-packages:
            packages: openssh-client rsync
        - add-to-known_hosts:
            hostname: $HOSTNAME
        - mktemp:
            envvar: PRIVATEKEY_FILE
        - create-file:
            name: write key
            filename: $PRIVATEKEY_FILE
            content: $Deploy_to_Guediao_PRIVATE
            overwrite: true
#        - script:
#            name: transfer application
#            code: |
#                scp -r -i $PRIVATEKEY_FILE public/* $USER@$HOSTNAME:$DEPLOY_PATH/
        - sh4pe/rsync-deploy:
                destination: $DEPLOY_PATH
                source: ./public/*
                sshkey: $PRIVATEKEY_FILE
                user: $DEPLOY_USER
                host: $HOSTNAME